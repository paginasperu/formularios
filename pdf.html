<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Catálogos Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">

<div id="app" class="container mx-auto py-10 px-4">
    <header class="text-center mb-10">
        <h1 class="text-4xl font-bold text-gray-800">Generador de Catálogos PDF</h1>
        <p class="text-gray-600">Sube tu CSV y crea un catálogo profesional al instante</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="bg-white p-6 rounded-xl shadow-lg h-fit">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2">Configuración</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">1. Subir CSV</label>
                    <input type="file" @change="handleFileUpload" accept=".csv" 
                           class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">2. Nombre del Negocio</label>
                    <input v-model="config.businessName" type="text" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">3. Color de Marca</label>
                    <input v-model="config.color" type="color" class="w-full h-10 rounded-lg cursor-pointer">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">4. Estilo de Plantilla</label>
                    <select v-model="config.template" class="w-full p-2 border rounded-lg">
                        <option value="minimal">Minimalista (Fotos Grandes)</option>
                        <option value="table">Corporativo (Tabla Detallada)</option>
                    </select>
                </div>

                <button @click="generatePDF" :disabled="products.length === 0"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-200 disabled:bg-gray-400">
                    Descargar PDF
                </button>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg min-h-[400px]">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Vista Previa de Datos ({{products.length}} productos)</h2>
                
                <div v-if="products.length === 0" class="flex flex-col items-center justify-center py-20 text-gray-400">
                    <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    <p>Sube un archivo para comenzar</p>
                </div>

                <div v-else class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-gray-700 uppercase font-bold">
                            <tr>
                                <th class="p-3">Nombre</th>
                                <th class="p-3">Precio</th>
                                <th class="p-3">Descripción</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(p, i) in products.slice(0, 10)" :key="i" class="border-b">
                                <td class="p-3">{{p.nombre}}</td>
                                <td class="p-3 font-bold text-green-600">${{p.precio}}</td>
                                <td class="p-3 text-gray-500">{{p.descripcion}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <p v-if="products.length > 10" class="mt-4 text-center text-gray-400">...y {{products.length - 10}} productos más.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            products: [],
            config: {
                businessName: 'Mi Catálogo Digital',
                color: '#2563eb',
                template: 'minimal'
            }
        }
    },
    methods: {
        handleFileUpload(event) {
            const file = event.target.files[0];
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                complete: (results) => {
                    this.products = results.data.filter(p => p.nombre);
                }
            });
        },
        async generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const hexToRgb = (hex) => {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return [r, g, b];
            };

            const primaryColor = hexToRgb(this.config.color);

            // Título
            doc.setFontSize(22);
            doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
            doc.text(this.config.businessName, 105, 20, { align: 'center' });
            
            if (this.config.template === 'table') {
                // Plantilla Corporativa (Tabla)
                doc.autoTable({
                    startY: 30,
                    head: [['Producto', 'Descripción', 'Precio']],
                    body: this.products.map(p => [p.nombre, p.descripcion, `$${p.precio}`]),
                    headStyles: { fillColor: primaryColor }
                });
            } else {
                // Plantilla Minimalista (Cards)
                let y = 40;
                this.products.forEach((p, index) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    
                    doc.setFontSize(14);
                    doc.setTextColor(0, 0, 0);
                    doc.text(p.nombre, 20, y);
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(p.descripcion || '', 20, y + 5);
                    
                    doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.setFont(undefined, 'bold');
                    doc.text(`$${p.precio}`, 170, y, { align: 'right' });
                    
                    doc.setDrawColor(230, 230, 230);
                    doc.line(20, y + 10, 190, y + 10);
                    y += 20;
                });
            }

            doc.save(`${this.config.businessName}.pdf`);
        }
    }
}).mount('#app');
</script>
</body>
</html>
